apiVersion: v1
kind: ConfigMap
metadata:
  name: frigate-config
data:
  config.yml: |
    go2rtc:
      streams:
        hall_cam: exec:ffmpeg -hide_banner -hwaccel cuda -hwaccel_output_format cuda -re -headers "Authorization: Bearer {FRIGATE_HA_TOKEN}" -headers "Content-Type: application/json" -i "http://home-assistant.homeassistant.svc.cluster.local:8123/api/camera_proxy_stream/camera.acessoweb_scseg_com_br" -c copy -rtsp_transport tcp -f rtsp {{output}}
    cameras:
      hall_cam:
        enabled: true
        inputs:
          - path: rtsp://127.0.0.1:8554/hall_cam
            roles:
              - detect
              - record
        detect:
          width: 1280
          height: 720
          fps: 5
    mqtt:
      enabled: False
    snapshots:
      enabled: True
      retain:
        default: 30
    model:
      path: /config/model_cache/tensorrt/yolov7-tiny-416.trt
      input_tensor: nchw
      input_pixel_format: rgb
      width: 416
      height: 416
    ffmpeg:
      global_args: -hide_banner
      hwaccel_args: preset-nvidia-h264 #preset-vaapi
      input_args: preset-rtsp-restream
      output_args:
        record: -f segment -segment_time 60 -segment_format mp4 -reset_timestamps 1 -strftime 1 -c copy -an
        detect: -f rawvideo -pix_fmt yuv420p
    detectors:
      tensorrt:
        type: tensorrt
    database:
      path: /config/frigate.db
    audio:
      enabled: False
    record:
      enabled: True
      retain:
        days: 3
        mode: all
      events:
        retain:
          default: 30
          mode: motion
      export:
        timelapse_args: "-vf setpts=0.04*PTS -r 30"
    motion:
      threshold: 30
      lightning_threshold: 0.8
      contour_area: 10
      frame_alpha: 0.01
      frame_height: 100
      improve_contrast: True
